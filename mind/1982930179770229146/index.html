<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100vw;
      height: 100vh;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
    <style>
      #audio-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }
      #audio-toggle {
        background: rgba(0, 20, 40, 0.8);
        border: 1px solid #66ffcc;
        color: #66ffcc;
        padding: 10px 20px;
        font-family: monospace;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 0 10px rgba(102, 255, 204, 0.3);
        transition: all 0.3s;
      }
      #audio-toggle:hover {
        background: rgba(0, 30, 60, 0.9);
        box-shadow: 0 0 15px rgba(102, 255, 204, 0.5);
      }
    </style>
</head>
<body>
    <div id="audio-controls">
      <button id="audio-toggle">ðŸ”Š PLAY HUM</button>
    </div>
  <script>
window._errors = [];
window.addEventListener('error', (e) => {
  window._errors.push(e.message + ' at ' + e.filename + ':' + e.lineno);
  console.error(e.message, e.filename, e.lineno);
});

const canvas=document.createElement('canvas');
canvas.width=800;
canvas.height=800;
const ctx=canvas.getContext('2d');
const duration=30;
const rotationSpeed=2;
let seed=42;
function random(){seed=(seed*9301+49297)%233280;return seed/233280;}
const nodes=[];
const count=12;
const radius=280;
for(let i=0;i<count;i++){
  nodes.push({
    angle:i/count*Math.PI*2,
    r:radius,
    connections:[]
  });
}
for(let i=0;i<count;i++){
  const n1=Math.floor(random()*count);
  const n2=Math.floor(random()*count);
  if(n1!==n2&&!nodes[i].connections.some(c=>c===n1||c===n2)){
    nodes[i].connections.push(n1,n2);
  }
}
window.renderFrame=function(time){
  const progress=(time/duration)*rotationSpeed;
  const baseRot=progress*Math.PI*2;
  ctx.fillStyle='#0a0a0f';
  ctx.fillRect(0,0,800,800);
  const cx=400,cy=400;
  ctx.globalCompositeOperation='lighter';
  for(let layer=0;layer<3;layer++){
    const layerPhase=layer*0.33;
    const layerRot=(progress+layerPhase)%1;
    const rot=layerRot*Math.PI*2;
    const warp=Math.sin(progress*Math.PI*4)*0.15;
    for(let i=0;i<count;i++){
      const n=nodes[i];
      const a=n.angle+rot;
      const r=n.r*(1+Math.sin(progress*Math.PI*2+i*0.5)*0.2);
      const x=cx+Math.cos(a)*r;
      const y=cy+Math.sin(a)*r;
      const glow=ctx.createRadialGradient(x,y,0,x,y,30);
      const hue=180+(layer*40)+Math.sin(progress*Math.PI*2+i*0.3)*30;
      glow.addColorStop(0,`hsla(${hue},80%,60%,0.6)`);
      glow.addColorStop(1,`hsla(${hue},80%,60%,0)`);
      ctx.fillStyle=glow;
      ctx.beginPath();
      ctx.arc(x,y,30,0,Math.PI*2);
      ctx.fill();
      ctx.strokeStyle=`hsla(${hue},70%,50%,0.3)`;
      ctx.lineWidth=2;
      for(let ci=0;ci<n.connections.length;ci++){
        const target=nodes[n.connections[ci]];
        const ta=target.angle+rot;
        const tr=target.r*(1+Math.sin(progress*Math.PI*2+n.connections[ci]*0.5)*0.2);
        const tx=cx+Math.cos(ta)*tr;
        const ty=cy+Math.sin(ta)*tr;
        const dist=Math.hypot(tx-x,ty-y);
        const pulse=Math.sin(progress*Math.PI*4-dist*0.01)*0.5+0.5;
        ctx.globalAlpha=0.2+pulse*0.3;
        ctx.beginPath();
        ctx.moveTo(x,y);
        const mx=(x+tx)/2+Math.sin(progress*Math.PI*2+i)*40;
        const my=(y+ty)/2+Math.cos(progress*Math.PI*2+i)*40;
        ctx.quadraticCurveTo(mx,my,tx,ty);
        ctx.stroke();
      }
    }
  }
  ctx.globalAlpha=1;
  ctx.globalCompositeOperation='source-over';
  const vortex=Math.sin(progress*Math.PI*2)*0.3;
  for(let ring=0;ring<5;ring++){
    const rr=50+ring*40;
    const segments=8+ring*4;
    const ringPhase=(progress+ring*0.1)%1;
    const ringRot=ringPhase*Math.PI*2;
    ctx.strokeStyle=`hsla(${200+ring*20},60%,40%,${0.3-ring*0.05})`;
    ctx.lineWidth=1;
    ctx.beginPath();
    for(let s=0;s<=segments;s++){
      const a=ringRot+s/segments*Math.PI*2;
      const twist=Math.sin(progress*Math.PI*4+ring)*vortex;
      const x=cx+Math.cos(a+twist)*rr;
      const y=cy+Math.sin(a+twist)*rr;
      if(s===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
    }
    ctx.stroke();
  }
  return canvas.toDataURL('image/png');
};
window.generateAudio=function(audioCtx){
  const now=audioCtx.currentTime;
  const hum=audioCtx.createOscillator();
  hum.type='sine';
  hum.frequency.value=110;
  const humLfo=audioCtx.createOscillator();
  humLfo.type='sine';
  humLfo.frequency.value=0.3;
  const humLfoGain=audioCtx.createGain();
  humLfoGain.gain.value=5;
  humLfo.connect(humLfoGain);
  humLfoGain.connect(hum.frequency);
  const humGain=audioCtx.createGain();
  humGain.gain.value=0.28;
  hum.connect(humGain);
  humGain.connect(audioCtx.destination);
  hum.start(now);
  humLfo.start(now);
  const pad1=audioCtx.createOscillator();
  pad1.type='sine';
  pad1.frequency.value=165;
  const pad2=audioCtx.createOscillator();
  pad2.type='sine';
  pad2.frequency.value=170;
  const padGain=audioCtx.createGain();
  padGain.gain.value=0;
  padGain.gain.setValueAtTime(0,now);
  padGain.gain.linearRampToValueAtTime(0.15,now+4);
  pad1.connect(padGain);
  pad2.connect(padGain);
  padGain.connect(audioCtx.destination);
  pad1.start(now);
  pad2.start(now);
  const dtmfPairs=[[697,1209],[770,1336],[852,1477],[697,1477],[941,1209],[852,1336]];
  const scheduleSequence=(startTime)=>{
    const seqLength=4+Math.floor(Math.random()*4);
    for(let i=0;i<seqLength;i++){
      const pair=dtmfPairs[Math.floor(Math.random()*dtmfPairs.length)];
      const toneTime=startTime+i*0.15;
      const osc1=audioCtx.createOscillator();
      const osc2=audioCtx.createOscillator();
      osc1.frequency.value=pair[0];
      osc2.frequency.value=pair[1];
      const g=audioCtx.createGain();
      g.gain.value=0.12;
      osc1.connect(g);
      osc2.connect(g);
      g.connect(audioCtx.destination);
      osc1.start(toneTime);
      osc2.start(toneTime);
      osc1.stop(toneTime+0.1);
      osc2.stop(toneTime+0.1);
    }
  };
  scheduleSequence(now+2);
  scheduleSequence(now+8);
  scheduleSequence(now+14);
  scheduleSequence(now+21);
  scheduleSequence(now+27);
  return{hum,humLfo,pad1,pad2,humGain,padGain};
};
window.ready=true;

// Animation loop
document.body.appendChild(canvas);
let startTime = Date.now();
function animate() {
  const time = (Date.now() - startTime) / 1000;
  // Use duration from code if available, otherwise default to 30s
  const loopDuration = (typeof duration !== 'undefined') ? duration : 30;
  window.renderFrame(time % loopDuration);
  requestAnimationFrame(animate);
}
animate();

// Signal that the page is ready
window.ready = true;
  </script>
    
    <script src="/lib/mind-audio-player.js"></script>
  </body>
</html>