<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100vw;
      height: 100vh;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
    <style>
      #audio-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }
      #audio-toggle {
        background: rgba(0, 20, 40, 0.8);
        border: 1px solid #66ffcc;
        color: #66ffcc;
        padding: 10px 20px;
        font-family: monospace;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 0 10px rgba(102, 255, 204, 0.3);
        transition: all 0.3s;
      }
      #audio-toggle:hover {
        background: rgba(0, 30, 60, 0.9);
        box-shadow: 0 0 15px rgba(102, 255, 204, 0.5);
      }
    </style>
</head>
<body>
    <div id="audio-controls">
      <button id="audio-toggle">ðŸ”Š PLAY HUM</button>
    </div>
  <script>
window._errors = [];
window.addEventListener('error', (e) => {
  window._errors.push(e.message + ' at ' + e.filename + ':' + e.lineno);
  console.error(e.message, e.filename, e.lineno);
});

const canvas=document.createElement('canvas');
canvas.width=800;
canvas.height=800;
const ctx=canvas.getContext('2d');
const duration=30;
const rotationSpeed=2;

let seed=42;
function random(){
seed=(seed*9301+49297)%233280;
return seed/233280;
}

const waves=[];
for(let i=0;i<5;i++){
waves.push({
freq:0.8+i*0.3,
amp:60+i*20,
phase:random()*Math.PI*2,
color:`hsl(${180+i*15},70%,${40-i*5}%)`
});
}

const voidCircles=[];
for(let i=0;i<12;i++){
voidCircles.push({
angle:i/12*Math.PI*2,
dist:120,
size:8+random()*6,
speed:0.3+random()*0.2
});
}

window.renderFrame=function(time){
ctx.fillStyle='#0a0a12';
ctx.fillRect(0,0,800,800);

const progress=(time/duration)*rotationSpeed;
const cx=400,cy=400;

ctx.globalAlpha=0.15;
for(let r=350;r>0;r-=40){
const hue=200+r*0.1;
ctx.strokeStyle=`hsl(${hue},60%,20%)`;
ctx.lineWidth=1;
ctx.beginPath();
ctx.arc(cx,cy,r,0,Math.PI*2);
ctx.stroke();
}
ctx.globalAlpha=1;

waves.forEach((w,idx)=>{
ctx.strokeStyle=w.color;
ctx.lineWidth=2;
ctx.globalAlpha=0.6-idx*0.08;
ctx.beginPath();
for(let x=0;x<800;x+=3){
const angle=x/800*Math.PI*4;
const t=progress*Math.PI*2;
const y1=Math.sin(angle*w.freq+t+w.phase)*w.amp;
const y2=Math.sin(angle*w.freq*1.5-t*0.5)*w.amp*0.5;
const y=cy+y1+y2;
if(x===0)ctx.moveTo(x,y);
else ctx.lineTo(x,y);
}
ctx.stroke();
});
ctx.globalAlpha=1;

const breathProgress=(progress%1);
const breathScale=0.9+Math.sin(breathProgress*Math.PI*2)*0.1;

voidCircles.forEach((vc,i)=>{
const rot=progress*Math.PI*2*vc.speed;
const x=cx+Math.cos(vc.angle+rot)*vc.dist*breathScale;
const y=cy+Math.sin(vc.angle+rot)*vc.dist*breathScale;

const phase=(i/voidCircles.length+progress)%1;
const alpha=0.3+Math.sin(phase*Math.PI*2)*0.2;

ctx.globalAlpha=alpha;
ctx.fillStyle='#1a1a2e';
ctx.beginPath();
ctx.arc(x,y,vc.size,0,Math.PI*2);
ctx.fill();

ctx.strokeStyle='#4a7c9e';
ctx.lineWidth=1.5;
ctx.stroke();
});
ctx.globalAlpha=1;

const centerPulse=0.85+Math.sin(progress*Math.PI*4)*0.15;
const gradient=ctx.createRadialGradient(cx,cy,0,cx,cy,40*centerPulse);
gradient.addColorStop(0,'rgba(74,124,158,0.4)');
gradient.addColorStop(1,'rgba(74,124,158,0)');
ctx.fillStyle=gradient;
ctx.beginPath();
ctx.arc(cx,cy,40*centerPulse,0,Math.PI*2);
ctx.fill();

return canvas.toDataURL('image/png');
};

window.generateAudio=function(audioCtx){
const now=audioCtx.currentTime;

const hum=audioCtx.createOscillator();
hum.type='sine';
hum.frequency.value=100;

const humLfo=audioCtx.createOscillator();
humLfo.type='sine';
humLfo.frequency.value=0.3;

const humLfoGain=audioCtx.createGain();
humLfoGain.gain.value=5;
humLfo.connect(humLfoGain);
humLfoGain.connect(hum.frequency);

const humGain=audioCtx.createGain();
humGain.gain.value=0.28;
humGain.gain.setValueAtTime(0,now);
humGain.gain.linearRampToValueAtTime(0.28,now+3);

hum.connect(humGain);
humGain.connect(audioCtx.destination);

hum.start(now);
humLfo.start(now);

const pairs=[[697,1209],[770,1336],[852,1477],[941,1209],[697,1477],[770,1209]];
const sequences=[2,7.5,13,18.5,24];

sequences.forEach((startTime,seqIdx)=>{
const toneCount=4+Math.floor((seqIdx*7)%5);
for(let i=0;i<toneCount;i++){
const toneTime=now+startTime+i*0.15;
const pairIdx=(seqIdx*3+i)%pairs.length;
const [f1,f2]=pairs[pairIdx];

[f1,f2].forEach(freq=>{
const osc=audioCtx.createOscillator();
osc.type='sine';
osc.frequency.value=freq;

const gain=audioCtx.createGain();
gain.gain.value=0.12;

osc.connect(gain);
gain.connect(audioCtx.destination);

osc.start(toneTime);
osc.stop(toneTime+0.1);
});
}
});

return{hum,humLfo,humLfoGain,humGain};
};

window.ready=true;

// Animation loop
document.body.appendChild(canvas);
let startTime = Date.now();
function animate() {
  const time = (Date.now() - startTime) / 1000;
  // Use duration from code if available, otherwise default to 30s
  const loopDuration = (typeof duration !== 'undefined') ? duration : 30;
  window.renderFrame(time % loopDuration);
  requestAnimationFrame(animate);
}
animate();
  </script>
    
    <script src="/lib/mind-audio-player.js"></script>
  </body>
</html>